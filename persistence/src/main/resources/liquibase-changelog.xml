<!--
    Copyright (c) 2015 Development Gateway, Inc and others.

    All rights reserved. This program and the accompanying materials
    are made available under the terms of the MIT License (MIT)
    which accompanies this distribution, and is available at
    https://opensource.org/licenses/MIT

    Contributors:
    Development Gateway - initial API and implementation
-->
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    
    <changeSet id="AD3-26" author="Octavian Ciubotaru">
        <preConditions onFail="CONTINUE">
            <tableExists tableName="person" />
            <columnExists tableName="person" columnName="organization_id" />
            <tableExists tableName="role" />
            <tableExists tableName="person_roles" />
            <tableExists tableName="category" />
        </preConditions>
        <insert tableName="category">
            <column name="id" valueSequenceNext="hibernate_sequence" />
            <column name="dtype" value="Organization" />
            <column name="label" value="FAO" />
        </insert>
        <insert tableName="person">
            <column name="id" valueSequenceNext="hibernate_sequence" />
            <column name="username" value="admin" />
            <column name="email" value="admin@developmentgateway.org" />
            <column name="enabled" value="true" />
            <column name="password" value="$2a$10$BTYSCSAFdv8K31CsY8RnN.FsJHp8xcUcMxWvf2L7QR3.C2hP02cQe" />
        </insert>
        <insert tableName="person">
            <column name="id" valueSequenceNext="hibernate_sequence" />
            <column name="username" value="fao" />
            <column name="email" value="fao@developmentgateway.org" />
            <column name="enabled" value="true" />
            <column name="password" value="$2a$10$BTYSCSAFdv8K31CsY8RnN.FsJHp8xcUcMxWvf2L7QR3.C2hP02cQe" />
        </insert>
        <insert tableName="role">
            <column name="id" valueSequenceNext="hibernate_sequence" />
            <column name="authority" value="ROLE_ADMIN" />
        </insert>
        <insert tableName="role">
            <column name="id" valueSequenceNext="hibernate_sequence" />
            <column name="authority" value="ROLE_FOCAL_POINT" />
        </insert>
        <sql><![CDATA[
            INSERT INTO person_roles(person_id, roles_id)
            SELECT p.id, r.id
            FROM person p,
                 role r
            WHERE p.username = 'admin'
              AND r.authority = 'ROLE_ADMIN';
        ]]></sql>
        <sql><![CDATA[
            INSERT INTO person_roles(person_id, roles_id)
            SELECT p.id, r.id
            FROM person p,
                 role r
            WHERE p.username = 'fao'
              AND r.authority = 'ROLE_FOCAL_POINT';
        ]]></sql>
        <sql><![CDATA[
            UPDATE person
            SET organization_id=org.id
            FROM category org
            WHERE person.username = 'fao'
              AND org.dtype = 'Organization'
              AND org.label = 'FAO';
        ]]></sql>
    </changeSet>

    <changeSet id="regionInsert" author="Daniel Oliva">
        <preConditions onFail="CONTINUE">
            <tableExists tableName="region" />
        </preConditions>
        <sql>
            insert into region(id, name, code) values (1, 'Dakar', 'DK');
            insert into region(id, name, code) values (2, 'Diourbel', 'DL');
            insert into region(id, name, code) values (3, 'Fatick', 'FK');
            insert into region(id, name, code) values (4, 'Kaolack', 'KL');
            insert into region(id, name, code) values (5, 'Kolda', 'KD');
            insert into region(id, name, code) values (6, 'Louga', 'LG');
            insert into region(id, name, code) values (7, 'Matam', 'MT');
            insert into region(id, name, code) values (8, 'Saint-Louis', 'SL');
            insert into region(id, name, code) values (9, 'Tambacounda', 'TC');
            insert into region(id, name, code) values (10, 'Thiès', 'TH');
            insert into region(id, name, code) values (11, 'Ziguinchor', 'ZG');
            insert into region(id, name, code) values (12, 'Kaffrine', 'KF');
            insert into region(id, name, code) values (13, 'Kédougou', 'KG');
            insert into region(id, name, code) values (14, 'Sédhiou', 'SD');
        </sql>
    </changeSet>

</databaseChangeLog>
